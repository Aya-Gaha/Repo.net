@using X.PagedList
@using X.PagedList.Mvc.Core
@model IPagedList<AspCoreFirstApp.Models.Movie>

@{
    ViewData["Title"] = "Movies";
    var currentSort = (ViewData["CurrentSort"] as string) ?? "";
    var isDesc = string.Equals(currentSort, "name_desc", StringComparison.OrdinalIgnoreCase);
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <h2 class="page-title mb-0">Liste des films</h2>
        <div class="text-muted small">@Model.TotalItemCount film(s) • Page @Model.PageNumber sur @Model.PageCount</div>
    </div>
    <div class="page-actions">
        <a class="btn btn-primary" asp-action="Create">
            <i class="bi bi-plus-circle me-1"></i> Créer un film
        </a>
    </div>
</div>

<div class="card app-card">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-primary">
                <tr>
                    <th style="width:90px">ID</th>
                    <th>
                        <a class="sort-link text-white" asp-action="Index" asp-route-sortOrder="@ViewData["NameSort"]" asp-route-page="@Model.PageNumber">
                            Nom
                            <span class="sort-indicator">@(isDesc ? "↓" : "↑")</span>
                        </a>
                    </th>
                    <th>Genre</th>
                    <th style="width:120px">Image</th>
                    <th style="width:220px" class="text-end pe-3">Actions</th>
                </tr>
                </thead>
                <tbody>
                @foreach (var movie in Model)
                {
                    <tr>
                        <td class="fw-semibold">@movie.Id</td>
                        <td>
                            <a class="link-primary fw-semibold" asp-action="DetailsList" asp-route-id="@movie.Id">
                                @movie.Name
                            </a>
                        </td>
                        <td>
                            @(movie.Genre?.Name ?? "—")
                        </td>
                        <td>
                            @if (!string.IsNullOrEmpty(movie.ImageFile))
                            {
                                <img src="~/images/@movie.ImageFile" class="poster-thumb" alt="@movie.Name" />
                            }
                            else
                            {
                                <img src="~/inception.jpeg" class="poster-thumb" alt="Placeholder" />
                            }
                        </td>
                        <td class="text-end pe-3">
                            <div class="page-actions justify-content-end">
                                <a class="btn btn-sm btn-outline-primary" asp-action="DetailsList" asp-route-id="@movie.Id">Détails</a>
                                <a class="btn btn-sm btn-outline-secondary" asp-action="Edit" asp-route-id="@movie.Id">Modifier</a>
                                <a class="btn btn-sm btn-outline-danger" asp-action="Delete" asp-route-id="@movie.Id">Supprimer</a>
                            </div>
                        </td>
                    </tr>
                }
                </tbody>
            </table>
        </div>
    </div>
    <div class="card-footer d-flex justify-content-center py-3">
        @Html.PagedListPager(
            Model,
            page => Url.Action("Index", new {
                page,
                sortOrder = ViewData["CurrentSort"]
            })
        )
    </div>
</div>
